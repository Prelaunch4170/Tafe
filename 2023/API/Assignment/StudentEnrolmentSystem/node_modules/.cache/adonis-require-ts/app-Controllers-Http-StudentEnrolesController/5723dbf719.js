"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const StudentEnroled_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/StudentEnroled"));
const StudentValidator_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Validators/StudentValidator"));
class StudentEnrolesController {
    async index({ response }) {
        const student = await StudentEnroled_1.default.all();
        if (!student) {
            return response.notFound({ message: 'Student not found' });
        }
        else {
            return student;
        }
    }
    async show({ params, response }) {
        const student = await StudentEnroled_1.default.find(params.id);
        if (!student) {
            return response.notFound({ message: 'Student not found' });
        }
        else {
            return response.ok(student);
        }
    }
    async store({ request, response }) {
        const stdentExists = await StudentEnroled_1.default.find(request.input('student_id'));
        const payload = await request.validate(StudentValidator_1.default);
        if (stdentExists) {
            return response.json({ message: 'Student already exists' });
        }
        else {
            const student = await StudentEnroled_1.default.create(payload);
            return response.ok(student);
        }
    }
    async destroy({ params, response }) {
        const id = params.id;
        const student = await StudentEnroled_1.default.find(id);
        if (!student) {
            return response.notFound({ message: 'Student not found' });
        }
        await student.delete();
        return response.ok({ message: `Student ${id + ':' + "'" + student.given_name + "'"} was deleted successfully` });
    }
    async update({ request, response, params }) {
        const id = params.id;
        const student = await StudentEnroled_1.default.find(id);
        if (!student) {
            return response.notFound({ message: 'Student not found' });
        }
        if (request.method() === 'PATCH') {
            const payload = request.all();
            if (payload.given_name !== undefined) {
                student.given_name = payload.given_name;
            }
            if (payload.last_name !== undefined) {
                student.last_name = payload.last_name;
            }
            if (payload.email_address !== undefined) {
                student.email_address = payload.email_address;
            }
            await student.save();
            return response.ok(student.toJSON());
        }
        else if (request.method() === 'PUT') {
            const payload = await request.validate(StudentValidator_1.default);
            student.given_name = payload.given_name;
            student.last_name = payload.last_name;
            student.email_address = payload.email_address;
            if (payload.given_name !== undefined) {
                student.given_name = payload.given_name;
            }
            else {
                return response.json({ message: 'Enter Given Name' });
            }
            if (payload.last_name !== undefined) {
                student.last_name = payload.last_name;
            }
            else {
                return response.json({ message: 'Enter Last Name' });
            }
            if (payload.email_address !== undefined) {
                student.email_address = payload.email_address;
            }
            else {
                return response.json({ message: 'Enter Email' });
            }
            await student.save();
            return response.ok(student);
        }
    }
}
exports.default = StudentEnrolesController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3R1ZGVudEVucm9sZXNDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU3R1ZGVudEVucm9sZXNDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EscUdBQXNEO0FBQ3RELDZHQUE4RDtBQUU5RCxNQUFxQix3QkFBd0I7SUFFbEMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFDLFFBQVEsRUFBc0I7UUFDOUMsTUFBTSxPQUFPLEdBQUcsTUFBTSx3QkFBYyxDQUFDLEdBQUcsRUFBRSxDQUFBO1FBQzFDLElBQUksQ0FBQyxPQUFPLEVBQUM7WUFDVCxPQUFPLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBQyxPQUFPLEVBQUUsbUJBQW1CLEVBQUMsQ0FBQyxDQUFBO1NBQzNEO2FBQUk7WUFDRCxPQUFPLE9BQU8sQ0FBQTtTQUNqQjtJQUNELENBQUM7SUFDRSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUMsTUFBTSxFQUFDLFFBQVEsRUFBc0I7UUFFcEQsTUFBTSxPQUFPLEdBQUcsTUFBTSx3QkFBYyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUE7UUFDcEQsSUFBSSxDQUFDLE9BQU8sRUFBQztZQUNULE9BQU8sUUFBUSxDQUFDLFFBQVEsQ0FBQyxFQUFDLE9BQU8sRUFBRSxtQkFBbUIsRUFBQyxDQUFDLENBQUE7U0FDM0Q7YUFBSTtZQUNELE9BQU8sUUFBUSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQTtTQUM5QjtJQUNMLENBQUM7SUFFTSxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBdUI7UUFDekQsTUFBTSxZQUFZLEdBQUcsTUFBTSx3QkFBYyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUE7UUFDM0UsTUFBTSxPQUFPLEdBQUcsTUFBTSxPQUFPLENBQUMsUUFBUSxDQUFDLDBCQUFnQixDQUFDLENB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QUE7YUFDcEQ7WUFFRCxJQUFJLE9BQU8sQ0FBQyxTQUFTLEtBQUssU0FBUyxFQUFFO2dCQUNuQyxPQUFPLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUM7YUFDdkM7aUJBQUk7Z0JBQ0gsT0FBTyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsT0FBTyxFQUFFLGlCQUFpQixFQUFDLENBQUMsQ0FBQTthQUNuRDtZQUVELElBQUksT0FBTyxDQUFDLGFBQWEsS0FBSyxTQUFTLEVBQUU7Z0JBQ3ZDLE9BQU8sQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQzthQUMvQztpQkFBSTtnQkFDSCxPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsYUFBYSxFQUFDLENBQUMsQ0FBQTthQUMvQztZQUNILE1BQU0sT0FBTyxDQUFDLElBQUksRUFBRSxDQUFBO1lBQ3BCLE9BQU8sUUFBUSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUMvQjtJQUNMLENBQUM7Q0FHSjtBQWpHRCwyQ0FpR0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xyXG5pbXBvcnQgU3R1ZGVudEVucm9sZWQgZnJvbSAnQXBwL01vZGVscy9TdHVkZW50RW5yb2xlZCdcclxuaW1wb3J0IFN0dWRlbnRWYWxpZGF0b3IgZnJvbSAnQXBwL1ZhbGlkYXRvcnMvU3R1ZGVudFZhbGlkYXRvcidcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN0dWRlbnRFbnJvbGVzQ29udHJvbGxlciB7XHJcbiAgICAvL0dFVFxyXG4gICAgcHVibGljIGFzeW5jIGluZGV4KHtyZXNwb25zZX06IEh0dHBDb250ZXh0Q29udHJhY3Qpe1xyXG4gICAgICAgIGNvbnN0IHN0dWRlbnQgPSBhd2FpdCBTdHVkZW50RW5yb2xlZC5hbGwoKVxyXG4gICAgICAgIGlmICghc3R1ZGVudCl7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5ub3RGb3VuZCh7bWVzc2FnZTogJ1N0dWRlbnQgbm90IGZvdW5kJ30pXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHJldHVybiBzdHVkZW50XHJcbiAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIHB1YmxpYyBhc3luYyBzaG93KHtwYXJhbXMscmVzcG9uc2V9OiBIdHRwQ29udGV4dENvbnRyYWN0KXtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBzdHVkZW50ID0gYXdhaXQgU3R1ZGVudEVucm9sZWQuZmluZChwYXJhbXMuaWQpXHJcbiAgICAgICAgaWYgKCFzdHVkZW50KXtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm5vdEZvdW5kKHttZXNzYWdlOiAnU3R1ZGVudCBub3QgZm91bmQnfSlcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKHN0dWRlbnQpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy9QT1NUXHJcbiAgICBwdWJsaWMgYXN5bmMgc3RvcmUoeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgICAgICAgY29uc3Qgc3RkZW50RXhpc3RzID0gYXdhaXQgU3R1ZGVudEVucm9sZWQuZmluZChyZXF1ZXN0LmlucHV0KCdzdHVkZW50X2lkJykpXHJcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IGF3YWl0IHJlcXVlc3QudmFsaWRhdGUoU3R1ZGVudFZhbGlkYXRvcilcclxuICAgICAgICBpZiAoc3RkZW50RXhpc3RzKXtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oe21lc3NhZ2U6ICdTdHVkZW50IGFscmVhZHkgZXhpc3RzJ30pXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0dWRlbnQ6IFN0dWRlbnRFbnJvbGVkID0gYXdhaXQgU3R1ZGVudEVucm9sZWQuY3JlYXRlKHBheWxvYWQpXHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5vayhzdHVkZW50KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vRGVsZXRlXHJcbiAgICBwdWJsaWMgYXN5bmMgZGVzdHJveSh7cGFyYW1zLCByZXNwb25zZX06IEh0dHBDb250ZXh0Q29udHJhY3Qpe1xyXG4gICAgICAgIGNvbnN0IGlkID0gcGFyYW1zLmlkIFxyXG4gICAgICAgIGNvbnN0IHN0dWRlbnQgPSBhd2FpdCBTdHVkZW50RW5yb2xlZC5maW5kKGlkKVxyXG5cclxuICAgICAgICBpZighc3R1ZGVudCl7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5ub3RGb3VuZCh7bWVzc2FnZTogJ1N0dWRlbnQgbm90IGZvdW5kJ30pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGF3YWl0IHN0dWRlbnQuZGVsZXRlKClcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKHttZXNzYWdlOiBgU3R1ZGVudCAke2lkICsgJzonICsgXCInXCIgKyBzdHVkZW50LmdpdmVuX25hbWUgK1wiJ1wifSB3YXMgZGVsZXRlZCBzdWNjZXNzZnVsbHlgfSlcclxuICAgIH1cclxuICAgIC8vUFVUXHJcbiAgICBwdWJsaWMgYXN5bmMgdXBkYXRlKHtyZXF1ZXN0LCByZXNwb25zZSwgcGFyYW1zfTogSHR0cENvbnRleHRDb250cmFjdCl7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgaWQgPSBwYXJhbXMuaWRcclxuXHJcbiAgICAgICAgY29uc3Qgc3R1ZGVudCA9IGF3YWl0IFN0dWRlbnRFbnJvbGVkLmZpbmQoaWQpXHJcbiAgICBcclxuICAgICAgICBpZighc3R1ZGVudCl7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5ub3RGb3VuZCh7bWVzc2FnZTogJ1N0dWRlbnQgbm90IGZvdW5kJ30pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXF1ZXN0Lm1ldGhvZCgpPT09ICdQQVRDSCcpe1xyXG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gcmVxdWVzdC5hbGwoKTtcclxuICAgICAgXHJcbiAgICAgICAgICAgIGlmIChwYXlsb2FkLmdpdmVuX25hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgIHN0dWRlbnQuZ2l2ZW5fbmFtZSA9IHBheWxvYWQuZ2l2ZW5fbmFtZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgICAgICBpZiAocGF5bG9hZC5sYXN0X25hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgIHN0dWRlbnQubGFzdF9uYW1lID0gcGF5bG9hZC5sYXN0X25hbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHBheWxvYWQuZW1haWxfYWRkcmVzcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgc3R1ZGVudC5lbWFpbF9hZGRyZXNzID0gcGF5bG9hZC5lbWFpbF9hZGRyZXNzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGF3YWl0IHN0dWRlbnQuc2F2ZSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2soc3R1ZGVudC50b0pTT04oKSk7XHJcbiAgICAgICAgfWVsc2UgaWYgKHJlcXVlc3QubWV0aG9kKCk9PT0gJ1BVVCcpe1xyXG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gYXdhaXQgcmVxdWVzdC52YWxpZGF0ZShTdHVkZW50VmFsaWRhdG9yKVxyXG4gICAgICAgICAgICBzdHVkZW50LmdpdmVuX25hbWUgPSBwYXlsb2FkLmdpdmVuX25hbWVcclxuICAgICAgICAgICAgc3R1ZGVudC5sYXN0X25hbWUgPSBwYXlsb2FkLmxhc3RfbmFtZVxyXG4gICAgICAgICAgICBzdHVkZW50LmVtYWlsX2FkZHJlc3MgPSBwYXlsb2FkLmVtYWlsX2FkZHJlc3NcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChwYXlsb2FkLmdpdmVuX25hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgc3R1ZGVudC5naXZlbl9uYW1lID0gcGF5bG9hZC5naXZlbl9uYW1lO1xyXG4gICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oe21lc3NhZ2U6ICdFbnRlciBHaXZlbiBOYW1lJ30pXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAgICAgaWYgKHBheWxvYWQubGFzdF9uYW1lICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHN0dWRlbnQubGFzdF9uYW1lID0gcGF5bG9hZC5sYXN0X25hbWU7XHJcbiAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbih7bWVzc2FnZTogJ0VudGVyIExhc3QgTmFtZSd9KVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIGlmIChwYXlsb2FkLmVtYWlsX2FkZHJlc3MgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgc3R1ZGVudC5lbWFpbF9hZGRyZXNzID0gcGF5bG9hZC5lbWFpbF9hZGRyZXNzO1xyXG4gICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oe21lc3NhZ2U6ICdFbnRlciBFbWFpbCd9KVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYXdhaXQgc3R1ZGVudC5zYXZlKClcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKHN0dWRlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG59XHJcblxyXG4iXX0=